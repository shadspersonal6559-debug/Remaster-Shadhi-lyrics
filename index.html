<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RemasterShadhi: AI Multi-Language Lyric Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for better UX (for GitHub/Netlify, use the main CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        // Define Custom Color Variables in CSS for easier access and consistency
        document.documentElement.style.setProperty('--primary-orange', '#FF8A00');
        document.documentElement.style.setProperty('--primary-dark-bg', '#0F0F0F');
        document.documentElement.style.setProperty('--card-bg', '#1A1A1A');
        document.documentElement.style.setProperty('--text-light', '#E0E0E0');
        document.documentElement.style.setProperty('--input-bg', '#2C2C2C');
        document.documentElement.style.setProperty('--input-border', '#4A4A4A');
    </script>

    <script>
        // Custom Tailwind Configuration to use CSS variables
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rs-orange': 'var(--primary-orange)',
                        'rs-dark-bg': 'var(--primary-dark-bg)',
                        'rs-card-bg': 'var(--card-bg)',
                        'rs-text': 'var(--text-light)',
                        'rs-input-bg': 'var(--input-bg)',
                        'rs-input-border': 'var(--input-border)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar Styling (Required) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--primary-dark-bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-orange);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #e57e00;
        }

        /* Custom Select Styling (Required) */
        .custom-select {
            appearance: none; /* Hide native arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            /* Orange SVG arrow for consistency */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FF8A00" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.5em;
            padding-right: 2.5rem !important; /* Make space for the icon */
        }
    </style>
</head>
<body class="bg-rs-dark-bg text-rs-text min-h-screen font-sans">
    <div id="app" class="max-w-lg mx-auto p-4 md:p-6">

        <!-- Header -->
        <header class="text-center mb-8 pt-4">
            <div class="flex items-center justify-center space-x-3 mb-4">
                <!-- Logo Placeholder -->
                <img src="https://placehold.co/112x112/FF8A00/0F0F0F?text=RS" 
                     alt="RemasterShadhi Logo" 
                     onerror="this.onerror=null; this.src='https://placehold.co/112x112/FF8A00/0F0F0F?text=RS';"
                     class="rounded-full w-16 h-16 shadow-lg border border-rs-orange">
                <h1 class="text-4xl font-extrabold tracking-tight">
                    <span class="text-white">REMASTER</span>
                    <span class="text-rs-orange italic">Shadhi</span>
                </h1>
            </div>
            <p class="text-sm text-gray-400">AI Multi-Language Lyric Generator | Powered by Gemini-2.5-Flash</p>
        </header>

        <!-- Main Form Card -->
        <main class="bg-rs-card-bg p-6 rounded-xl shadow-2xl border border-gray-800">
            <form id="lyricForm">
                <div class="mb-6">
                    <label for="theme" class="block text-sm font-semibold mb-2 text-rs-text">Theme / Story / Emotion (Required)</label>
                    <textarea id="theme" name="theme" rows="4" required
                        class="w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange placeholder-gray-500 text-rs-text transition-colors"
                        placeholder="E.g., A vibrant celebration of a traditional Indian festival with modern beats."></textarea>
                </div>

                <!-- Target Language -->
                <div class="mb-6">
                    <label for="language" class="block text-sm font-semibold mb-2 text-rs-text">Target Language</label>
                    <div class="relative">
                        <select id="language" name="language" required class="custom-select w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange text-rs-text transition-colors">
                            <option value="English">English</option>
                            <option value="Hindi">Hindi</option>
                            <option value="Tamil (தமிழ்)">Tamil (தமிழ்)</option>
                            <option value="Malayalam (മലയാളം)">Malayalam (മലയാളം)</option>
                        </select>
                    </div>
                </div>

                <!-- Advanced Options Collapsible Section -->
                <div class="mb-8 border-t border-gray-700 pt-4">
                    <button type="button" id="toggleAdvanced" class="flex justify-between items-center w-full text-left py-2 font-bold text-rs-orange hover:text-white transition-colors">
                        <span class="flex items-center">
                            <i data-lucide="settings-2" class="w-5 h-5 mr-2"></i>
                            Advanced Options (Optional)
                        </span>
                        <i data-lucide="chevron-down" id="advancedIcon" class="w-5 h-5 transition-transform duration-300"></i>
                    </button>

                    <div id="advancedContent" class="space-y-4 mt-3 hidden">
                        <!-- Genre -->
                        <div>
                            <label for="genre" class="block text-sm font-semibold mb-2 text-rs-text">Genre</label>
                            <div class="relative">
                                <select id="genre" name="genre" class="custom-select w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange text-rs-text">
                                    <option value="">(Any / Default)</option>
                                    <option value="Pop">Pop</option>
                                    <option value="Rock">Rock</option>
                                    <option value="Hip-Hop/Rap">Hip-Hop/Rap</option>
                                    <option value="R&B">R&B</option>
                                    <option value="Acoustic Ballad">Acoustic Ballad</option>
                                    <option value="EDM/Dance">EDM/Dance</option>
                                    <option value="Regional/Filmi">Regional/Filmi (Bollywood/South Indian Cinema Style)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Mood/Tone -->
                        <div>
                            <label for="mood" class="block text-sm font-semibold mb-2 text-rs-text">Mood / Tone</label>
                            <div class="relative">
                                <select id="mood" name="mood" class="custom-select w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange text-rs-text">
                                    <option value="">(Any / Default)</option>
                                    <option value="Melancholic/Sad">Melancholic/Sad</option>
                                    <option value="Upbeat/Energetic">Upbeat/Energetic</option>
                                    <option value="Romantic/Lyrical">Romantic/Lyrical</option>
                                    <option value="Angry/Aggressive">Angry/Aggressive</option>
                                    <option value="Wistful/Nostalgic">Wistful/Nostalgic</option>
                                    <option value="Triumphant/Motivational">Triumphant/Motivational</option>
                                </select>
                            </div>
                        </div>

                        <!-- Target Audience -->
                        <div>
                            <label for="audience" class="block text-sm font-semibold mb-2 text-rs-text">Target Audience</label>
                            <div class="relative">
                                <select id="audience" name="audience" class="custom-select w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange text-rs-text">
                                    <option value="">(Any / Default)</option>
                                    <option value="Teens/Young Adult">Teens/Young Adult</option>
                                    <option value="General Audience">General Audience</option>
                                    <option value="Niche/Specific Theme">Niche/Specific Theme</option>
                                    <option value="Devotional/Spiritual">Devotional/Spiritual</option>
                                </select>
                            </div>
                        </div>

                        <!-- Rhyme Scheme/Style -->
                        <div>
                            <label for="rhyme" class="block text-sm font-semibold mb-2 text-rs-text">Overall Rhyme Scheme / Style</label>
                            <div class="relative">
                                <select id="rhyme" name="rhyme" class="custom-select w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange text-rs-text">
                                    <option value="">(Any / Default)</option>
                                    <option value="AABB (Couplets)">AABB (Couplets - Simple)</option>
                                    <option value="ABAB (Alternating)">ABAB (Alternating)</option>
                                    <option value="Free Verse (No strict rhyme)">Free Verse (No strict rhyme)</option>
                                    <option value="Slant Rhyme/Subtle">Slant Rhyme/Subtle</option>
                                </select>
                            </div>
                        </div>

                        <!-- Artist Style -->
                        <div>
                            <label for="artistStyle" class="block text-sm font-semibold mb-2 text-rs-text">Artist Style (e.g., A.R. Rahman, Drake, Taylor Swift)</label>
                            <input type="text" id="artistStyle" name="artistStyle"
                                class="w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange placeholder-gray-500 text-rs-text transition-colors"
                                placeholder="E.g., Inspired by the poetic flow of Gulzar...">
                        </div>

                        <!-- Additional Notes -->
                        <div>
                            <label for="additionalNotes" class="block text-sm font-semibold mb-2 text-rs-text">Additional Notes / Instructions</label>
                            <textarea id="additionalNotes" name="additionalNotes" rows="2"
                                class="w-full p-3 rounded-lg bg-rs-input-bg border border-rs-input-border focus:border-rs-orange focus:ring-1 focus:ring-rs-orange placeholder-gray-500 text-rs-text transition-colors"
                                placeholder="E.g., Keep the chorus catchy, 8 lines max."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button type="submit" id="generateButton"
                    class="w-full py-3 rounded-xl bg-rs-orange text-rs-dark-bg font-extrabold text-lg shadow-lg shadow-rs-orange/50 hover:bg-white hover:text-rs-dark-bg transition-all duration-300 flex items-center justify-center space-x-2">
                    <i data-lucide="music-4" class="w-5 h-5"></i>
                    <span>Generate Lyrics</span>
                </button>

                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="hidden mt-4 text-center">
                    <svg class="animate-spin h-6 w-6 text-rs-orange mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-sm text-gray-400 mt-2">Harmonizing the verses...</p>
                </div>
            </form>
        </main>

        <!-- Output Area -->
        <section id="lyricsOutputSection" class="mt-8 pt-6 border-t border-gray-700 hidden">
            <h2 class="text-2xl font-bold text-white mb-4">Generated Lyrics</h2>
            <div id="lyricsOutput" class="whitespace-pre-wrap p-5 rounded-xl bg-rs-card-bg border border-gray-800 shadow-xl text-rs-text leading-relaxed text-sm max-h-96 overflow-y-auto custom-scroll">
                Your generated song lyrics will appear here. Start by entering a theme and hitting 'Generate'.
            </div>
            <!-- Copy Button -->
            <button id="copyButton" class="mt-4 py-2 px-4 rounded-lg bg-rs-input-bg text-rs-orange font-semibold hover:bg-rs-input-border transition-colors flex items-center space-x-2">
                <i data-lucide="copy" class="w-4 h-4"></i>
                <span>Copy Lyrics</span>
            </button>
        </section>

        <!-- Custom Message Box (Non-native Alert) -->
        <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-rs-card-bg p-6 rounded-xl max-w-sm w-full shadow-2xl border border-rs-orange">
                <h3 id="messageTitle" class="text-xl font-bold text-rs-orange mb-3">Error</h3>
                <p id="messageContent" class="text-rs-text mb-4">An unknown error occurred.</p>
                <button id="closeMessage" class="w-full py-2 rounded-lg bg-rs-orange text-rs-dark-bg font-semibold hover:bg-white transition-colors">
                    Close
                </button>
            </div>
        </div>

    </div>

    <script type="module">
        // Initialize Lucide icons
        lucide.createIcons();

        // --- Global Variables and Constants ---
        const API_KEY = ""; // Keep empty: Netlify provides the key via environment variables or context if configured.
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";
        const MAX_RETRIES = 3;

        // --- DOM Elements ---
        const form = document.getElementById('lyricForm');
        const themeInput = document.getElementById('theme');
        const languageInput = document.getElementById('language');
        const genreInput = document.getElementById('genre');
        const moodInput = document.getElementById('mood');
        const audienceInput = document.getElementById('audience');
        const rhymeInput = document.getElementById('rhyme');
        const artistStyleInput = document.getElementById('artistStyle');
        const additionalNotesInput = document.getElementById('additionalNotes');
        const generateButton = document.getElementById('generateButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const lyricsOutputSection = document.getElementById('lyricsOutputSection');
        const lyricsOutput = document.getElementById('lyricsOutput');
        const copyButton = document.getElementById('copyButton');

        // Advanced options toggle
        const toggleAdvanced = document.getElementById('toggleAdvanced');
        const advancedContent = document.getElementById('advancedContent');
        const advancedIcon = document.getElementById('advancedIcon');

        // Message Box elements
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageContent = document.getElementById('messageContent');
        const closeMessageButton = document.getElementById('closeMessage');

        // --- Helper Functions ---

        const showMessage = (title, content) => {
            messageTitle.textContent = title;
            messageContent.textContent = content;
            // Add error/success classes based on title if needed, otherwise default to info style
            if (title.includes("Error") || title.includes("Failed")) {
                messageTitle.classList.add('text-red-500');
                messageTitle.classList.remove('text-rs-orange');
            } else {
                messageTitle.classList.add('text-rs-orange');
                messageTitle.classList.remove('text-red-500');
            }
            messageBox.classList.remove('hidden');
        };

        const fetchWithRetry = async (payload, retryCount = 0) => {
            // Netlify-specific: The environment will inject the API key through the runtime environment for the fetch call.
            const delay = Math.pow(2, retryCount) * 1000 + (Math.random() * 1000); 
            
            try {
                if (retryCount > 0) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                }

                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorDetails = await response.text();
                    console.error("API Error Response:", errorDetails);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return response.json();

            } catch (error) {
                console.error(`Attempt ${retryCount + 1} failed:`, error.message);
                if (retryCount < MAX_RETRIES) {
                    return fetchWithRetry(payload, retryCount + 1);
                }
                throw new Error("Failed to generate lyrics after multiple retries. Please check your inputs or network connection.");
            }
        };

        const buildPrompt = () => {
            const theme = themeInput.value.trim();
            const language = languageInput.value;

            const genre = genreInput.value.trim();
            const mood = moodInput.value.trim();
            const audience = audienceInput.value.trim();
            const rhyme = rhymeInput.value.trim();
            const artistStyle = artistStyleInput.value.trim();
            const additionalNotes = additionalNotesInput.value.trim();

            let prompt = `You are a professional lyricist. Write a complete song based on the following instructions.

Target Language: ${language}
Main Theme/Story/Emotion: "${theme}"

The output MUST contain the following sections, clearly labeled with their names: INTRO, VERSE 1, CHORUS, VERSE 2, BRIDGE, and OUTRO.

Crucial Instruction: Use different, suitable rhyme schemes or lyrical styles for each of the required sections (INTRO, VERSE 1, CHORUS, VERSE 2, BRIDGE, OUTRO) to enhance musicality, while respecting the overall preferred rhyme scheme if specified.

The final output must be a single block of text with no introductory or concluding commentary, just the formatted lyrics.

--- Optional Details ---
`;

            if (genre) prompt += `Genre Preference: ${genre}\n`;
            if (mood) prompt += `Mood/Tone: ${mood}\n`;
            if (audience) prompt += `Target Audience: ${audience}\n`;
            if (rhyme) prompt += `Overall Rhyme Scheme Preference (Use different schemes per section while aligning to this overall feel): ${rhyme}\n`;
            if (artistStyle) prompt += `Artist Style/Inspiration: ${artistStyle}\n`;
            if (additionalNotes) prompt += `Specific Instructions/Notes: ${additionalNotes}\n`;

            return prompt;
        };

        const generateLyrics = async () => {
            if (!themeInput.value.trim()) {
                showMessage("Input Required", "Please enter a theme, story, or emotion to begin writing!");
                return;
            }

            const prompt = buildPrompt();

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: {
                    parts: [{ text: "You are a creative, professional, and versatile lyricist capable of writing in multiple languages and adapting complex lyrical structures." }]
                }
            };

            lyricsOutput.textContent = 'Generating... Please wait.';
            lyricsOutputSection.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            generateButton.disabled = true;

            try {
                const result = await fetchWithRetry(payload);
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (generatedText) {
                    lyricsOutput.textContent = generatedText;
                    lyricsOutputSection.classList.remove('hidden');
                    lyricsOutputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    showMessage("Generation Failed", "The model did not return any lyrics. Please try again with a different theme.");
                }

            } catch (error) {
                showMessage("API Error", error.message);
            } finally {
                loadingIndicator.classList.add('hidden');
                generateButton.disabled = false;
            }
        };

        // --- Event Listeners ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            generateLyrics();
        });

        toggleAdvanced.addEventListener('click', (e) => {
            e.preventDefault();
            const isHidden = advancedContent.classList.toggle('hidden');
            if (isHidden) {
                advancedIcon.style.transform = 'rotate(0deg)';
            } else {
                advancedIcon.style.transform = 'rotate(180deg)';
            }
        });

        closeMessageButton.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        copyButton.addEventListener('click', () => {
            const textToCopy = lyricsOutput.textContent;
            try {
                // Using standard clipboard API
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showMessage("Copied!", "Lyrics successfully copied to your clipboard.");
                }).catch(() => {
                    // Fallback
                    const tempElement = document.createElement('textarea');
                    tempElement.value = textToCopy;
                    document.body.appendChild(tempElement);
                    tempElement.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempElement);
                    showMessage("Copied!", "Lyrics successfully copied to your clipboard (using fallback).");
                });
            } catch (err) {
                showMessage("Copy Error", "Could not copy text automatically. Please select the text manually.");
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
             lyricsOutput.textContent = "Your generated song lyrics will appear here. Start by entering a theme and hitting 'Generate'.";
        });
    </script>
</body>
</html>

